name: Eklentiyi Derle

on:
  workflow_dispatch:
  push:
    paths:
      - 'app/**'
      - 'build.gradle.kts'
      - 'settings.gradle.kts'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Depoyu Çek
        uses: actions/checkout@v3

      - name: Java Kurulumu (JDK 17)
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Gradle 7.6 ile Eklentiyi Derle
        uses: gradle/gradle-build-action@v2
        with:
          gradle-version: 7.6
          arguments: :app:makePluginsJson

      - name: Dosyaları Hazırla
        run: |
          mkdir -p release
          cp app/build/*.cs3 release/ 2>/dev/null || :
          cp app/build/*.json release/ 2>/dev/null || :

      - name: Release Oluştur (Builds Branchine At)
        uses: s0/git-publish-subdir-action@develop
        env:
          REPO: self
          BRANCH: builds
          FOLDER: app/build
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          MESSAGE: "Eklenti Güncellendi"
